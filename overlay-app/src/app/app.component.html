<div class="overlay-container" [class.collapsed]="collapsed()">
  <!-- Compact header bar -->
  <header class="header" (click)="onHeaderDoubleClick()">
    <div class="header-left">
      <!-- Collapse toggle -->
      <button
        (click)="toggleCollapsed(); $event.stopPropagation()"
        class="btn-icon collapse-btn"
        [title]="collapsed() ? 'Expand' : 'Collapse'">
        <svg class="chevron" [class.rotated]="collapsed()" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>
      <span class="title">BALATRO</span>
      @if (isConnected()) {
        <span class="status-dot connected"></span>
      } @else {
        <span class="status-dot disconnected"></span>
      }
    </div>
    <div class="header-right">
      <!-- Drag handle -->
      <div
        class="drag-handle"
        (mousedown)="onDragStart($event)"
        title="Drag to reposition">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"/>
        </svg>
      </div>
      <button
        (click)="toggleSettings(); $event.stopPropagation()"
        class="btn-icon"
        title="Settings">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- Settings panel (collapsible) -->
  @if (showSettings() && !collapsed()) {
    <div class="settings-panel">
      <div class="setting-row">
        <span class="setting-label">Opacity</span>
        <input
          type="range"
          class="opacity-slider"
          [min]="0.5"
          [max]="1"
          [step]="0.05"
          [value]="opacity()"
          (input)="onOpacityChange($any($event.target).valueAsNumber)">
        <span class="setting-value">{{ (opacity() * 100) | number:'1.0-0' }}%</span>
      </div>
      <div class="setting-row">
        <span class="setting-label">Click-through</span>
        <button
          class="toggle-pill"
          [class.active]="clickThroughEnabled()"
          (click)="toggleClickThrough()">
          {{ clickThroughEnabled() ? 'ON' : 'OFF' }}
        </button>
      </div>
    </div>
  }

  <!-- Main content area -->
  @if (!collapsed()) {
    <main class="main-content">
      @if (!isConnected()) {
        <div class="waiting-state">
          <div class="waiting-card">
            <div class="waiting-icon">ðŸŽ´</div>
            <p class="waiting-text">Waiting for Balatro...</p>
            <p class="waiting-hint">Launch game with mod</p>
          </div>
        </div>
      } @else {
        <div class="content-stack">
          <!-- Strategy indicator -->
          @if (strategyDisplay()) {
            <div class="strategy-indicator">
              <span class="strategy-label">Build:</span>
              <span class="strategy-name">{{ strategyDisplay()!.name }}</span>
              <span class="strategy-confidence">{{ strategyDisplay()!.confidence }}%</span>
            </div>
          }

          <!-- Shop advisor (only during shop phase) -->
          @if (isInShop()) {
            <app-shop-overlay />
          }

          <app-deck-tracker />
          <app-joker-bar />
          <router-outlet></router-outlet>
        </div>
      }
    </main>
  }

  <!-- Status bar -->
  <footer class="status-bar" [class.collapsed]="collapsed()">
    @if (isConnected()) {
      <div class="status-row status-top">
        <span class="phase-pill">{{ phase() }}</span>
      </div>
      <div class="status-row status-stats">
        <div class="stat-group">
          <span class="stat-label">Ante</span>
          <span class="stat-value">{{ currentAnte() }}</span>
        </div>
        <div class="stat-group">
          <span class="stat-label">Round</span>
          <span class="stat-value">{{ currentRound() }}</span>
        </div>
        <div class="stat-group">
          <span class="stat-label">Hands</span>
          <span class="stat-value stat-highlight">{{ handsRemaining() }}</span>
        </div>
        <div class="stat-group">
          <span class="stat-label">Disc</span>
          <span class="stat-value">{{ discardsRemaining() }}</span>
        </div>
      </div>
    } @else {
      <span class="status-disconnected">Disconnected</span>
    }
  </footer>
</div>
